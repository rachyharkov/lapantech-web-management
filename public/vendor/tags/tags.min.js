var g={allowNew:!1,showAllSuggestions:!1,badgeStyle:"primary",allowClear:!1,clearEnd:!1,selected:[],regex:"",separator:[],max:0,clearLabel:"Clear",searchLabel:"Type a value",keepOpen:!1,allowSame:!1,baseClass:"",placeholder:"",addOnBlur:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,fullWidth:!1,fixed:!1,labelField:"label",valueField:"value",queryParam:"query",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(o,e)=>e,onSelectItem:o=>{},onClearItem:o=>{},onServerResponse:o=>o.json()},p="tags-",y="is-loading",E="is-active",f=["is-active","bg-primary","text-white"],u="data-value",v="next",S="prev",w="form-control-focus",b=new WeakMap,A=0;function x(o,e=300){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>{o.apply(this,s)},e)}}function C(o,e=null){let t=document.createElement("span");document.body.appendChild(t),t.style.fontSize=e||"inherit",t.style.height="auto",t.style.width="auto",t.style.position="absolute",t.style.whiteSpace="no-wrap",t.innerHTML=o;let s=Math.ceil(t.clientWidth)+8;return document.body.removeChild(t),s}function L(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function I(o,e){return o.parentNode.insertBefore(e,o.nextSibling)}var m=class{constructor(e,t={}){if(!(e instanceof HTMLElement)){console.error("Invalid element",e);return}b.set(e,this),A++,this.l=e,this.L(t),this.h=!1,this.E=x(()=>{this.g(!0)},this.e.debounceTime),this.d=!0,this.u=[],this.C(),this.n=document.createElement("div"),this.r=document.createElement("div"),this.n.appendChild(this.r),I(this.l,this.n),this.I(),this.k(),this.F(),this.O(),this.T(),this.resetState(),this.e.fixed&&(document.addEventListener("scroll",this),document.addEventListener("resize",this)),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.q()}static init(e="select[multiple]",t={}){let s=document.querySelectorAll(e);for(let i=0;i<s.length;i++)m.getInstance(s[i])||new m(s[i],t)}static getInstance(e){if(b.has(e))return b.get(e)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.e.fixed&&(document.removeEventListener("scroll",this),document.removeEventListener("resize",this)),this.l.style.display="block",this.n.parentElement.removeChild(this.n),this.parentForm&&this.parentForm.removeEventListener("reset",this.reset),b.delete(this.l)}handleEvent(e){this[`on${e.type}`](e)}L(e={}){this.e=Object.assign({},g);let t={...e,...this.l.dataset},s=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i);for(let[i,l]of Object.entries(g)){if(t[i]===void 0)continue;let n=t[i];switch(typeof l){case"number":this.e[i]=parseInt(n);break;case"boolean":this.e[i]=s(n);break;case"string":this.e[i]=n.toString();break;case"object":if(Array.isArray(l)){let r=n.includes("|")?"|":",";this.e[i]=typeof n=="string"?n.split(r):n}else this.e[i]=typeof n=="string"?JSON.parse(n):n;break;case"function":this.e[i]=typeof n=="string"?window[n]:n;break;default:this.e[i]=n;break}}this.e.placeholder||(this.e.placeholder=this.D())}C(){for(this.overflowParent=null,this.parentForm=this.l.parentElement;this.parentForm&&(this.parentForm.style.overflow==="hidden"&&(this.overflowParent=this.parentForm),this.parentForm=this.parentForm.parentElement,!(this.parentForm&&this.parentForm.nodeName=="FORM")););this.reset=this.reset.bind(this),this.parentForm&&this.parentForm.addEventListener("reset",this.reset)}D(){if(this.l.hasAttribute("placeholder"))return this.l.getAttribute("placeholder");if(this.l.dataset.placeholder)return this.l.dataset.placeholder;let e=this.l.querySelector("option");return e?(e.hasAttribute("selected")&&e.removeAttribute("selected"),e.value?"":e.textContent):""}I(){this.l.style.position="absolute",this.l.style.left="-9999px",this.l.addEventListener("focus",e=>{this.s.focus()})}T(){this.i=document.createElement("ul"),this.i.classList.add("dropdown-menu",p+"menu","p-0"),this.i.setAttribute("id",p+"menu-"+A),this.i.setAttribute("role","menu"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",this.i.addEventListener("mouseenter",e=>{this.h=!1}),this.n.appendChild(this.i),this.s.setAttribute("aria-controls",this.i.getAttribute("id"))}k(){this.n.classList.add("form-control","dropdown"),this.l.classList.contains("form-select-lg")&&this.n.classList.add("form-control-lg"),this.l.classList.contains("form-select-sm")&&this.n.classList.add("form-control-sm"),this.overflowParent&&(this.n.style.position="inherit"),this.S()===4&&(this.n.style.height="auto")}F(){this.r.addEventListener("click",t=>{this.isDisabled()||this.s.style.visibility!="hidden"&&this.s.focus()}),this.r.style.display="flex",this.r.style.alignItems="center",this.r.style.flexWrap="wrap";let e=this.l.selectedOptions??[];for(let t=0;t<e.length;t++){let s=e[t];!s.value||(s.setAttribute("selected","selected"),this.u.push(s),this.w(s.textContent,s.value))}}O(){this.s=document.createElement("input"),this.s.type="text",this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox"),this.s.ariaLabel=this.e.searchLabel,this.s.style.backgroundColor="transparent",this.s.style.color="currentColor",this.s.style.border="0",this.s.style.outline="0",this.s.style.maxWidth="100%",this.resetSearchInput(!0),this.r.appendChild(this.s)}onfocus(e){this.n.classList.add(w),this.m()}onblur(e){this.o&&this.o.abort(),this.n.classList.remove(w),this.c(),this.e.keepOpen&&this.resetSearchInput();let t=this.getSelection(),s={selection:t?t.dataset.value:null,input:this.s.value};this.e.addOnBlur&&this.e.allowNew&&this.canAdd(s.input)&&(this.addItem(s.input),this.resetSearchInput()),this.d&&this.l.dispatchEvent(new CustomEvent("tags.blur",{bubbles:!0,detail:s}))}oninput(e){let t=this.s.value;if(t){let s=t.slice(-1);if(this.e.separator.length&&this.e.separator.includes(s)){this.s.value=this.s.value.slice(0,-1),this.f(this.s.value,null);return}}this.a(),this.m()}onkeydown(e){let t=e.keyCode||e.key,s=e.target;switch(e.keyCode==229&&(t=s.value.charAt(s.selectionStart-1).charCodeAt(0)),t){case 13:case"Enter":e.preventDefault();let i=this.getSelection();if(i)i.click();else if(this.e.allowNew&&this.s.value){let l=this.s.value;this.f(l,null)}break;case 38:case"ArrowUp":e.preventDefault(),this.h=!0,this.p(S);break;case 40:case"ArrowDown":e.preventDefault(),this.h=!0,this.p(v);break;case 8:case"Backspace":this.s.value.length==0&&(this.removeLastItem(),this.a(),this.m());break;case 27:case"Escape":this.s.focus(),this.c();break}}onmousemove(e){this.h=!1}onscroll(e){this.v()}onresize(e){this.v()}resetState(){this.isDisabled()?(this.n.setAttribute("readonly",""),this.s.setAttribute("disabled","")):(this.n.hasAttribute("readonly")&&this.n.removeAttribute("readonly"),this.s.hasAttribute("disabled")&&this.s.removeAttribute("disabled"))}resetSuggestions(){let e=Array.from(this.l.querySelectorAll("option")).filter(t=>!t.disabled).map(t=>({value:t.getAttribute("value"),label:t.textContent}));this.A(e)}g(e=!1){this.o&&this.o.abort(),this.o=new AbortController;let t=Object.assign({},this.e.serverParams);if(t[this.e.queryParam]=this.s.value,this.e.noCache&&(t.t=Date.now()),t.related){let i=document.getElementById(t.related);i&&(t.related=i.value)}let s=new URLSearchParams(t).toString();this.n.classList.add(y),fetch(this.e.server+"?"+s,{signal:this.o.signal}).then(i=>this.e.onServerResponse(i)).then(i=>{let l=i.data||i;this.A(l),this.o=null,e&&this.b()}).catch(i=>{i.name!=="AbortError"&&console.error(i)}).finally(i=>{this.n.classList.remove(y)})}f(e,t=null,s={}){!this.canAdd(e,t)||(this.addItem(e,t,s),this.e.keepOpen?this.b():this.resetSearchInput())}p(e=v){let t=this.getSelection(),s=null;if(t){let i=e===v?"nextSibling":"previousSibling";s=t.parentNode;do s=s[i];while(s&&s.style.display==="none");s?(t.classList.remove(...f),e===S?s.parentNode.scrollTop=s.offsetTop-s.parentNode.offsetTop:s.offsetTop>s.parentNode.offsetHeight-s.offsetHeight&&(s.parentNode.scrollTop+=s.offsetHeight)):t&&(s=t.parentElement)}else for(s=this.i.firstChild;s&&s.style.display==="none";)s=s.nextSibling;if(s){let i=s.querySelector("a");i.classList.add(...f),this.s.setAttribute("aria-activedescendant",i.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=i.dataset.label,this.a())}else this.s.setAttribute("aria-activedescendant","");return s}a(){this.s.value?this.s.size=this.s.value.length:this.getSelectedValues().length?(this.s.placeholder="",this.s.size=1):(this.s.size=this.e.placeholder.length>0?this.e.placeholder.length:1,this.s.placeholder=this.e.placeholder);let e=this.s.value||this.s.placeholder,t=window.getComputedStyle(this.n).fontSize,s=C(e,t);this.s.style.minWidth=s+"px"}A(e){for(;this.i.lastChild;)this.i.removeChild(this.i.lastChild);for(let t=0;t<e.length;t++){let s=e[t];if(!s[this.e.valueField])continue;let i=s[this.e.valueField],l=s[this.e.labelField];if(!this.e.liveServer&&(s.selected||this.e.selected.includes(i))){this.u.push({value:i,textContent:l,dataset:s.data}),this.f(l,i,s.data);continue}let n=this.e.onRenderItem(s,l),r=document.createElement("li");r.setAttribute("role","presentation");let a=document.createElement("a");r.append(a),a.setAttribute("id",this.i.getAttribute("id")+"-"+t),a.classList.add("dropdown-item","text-truncate"),a.setAttribute(u,i),a.setAttribute("data-label",l),a.setAttribute("href","#"),a.textContent=n,this.i.appendChild(r),a.addEventListener("mouseenter",h=>{this.h||(this.removeSelection(),r.querySelector("a").classList.add(...f))}),a.addEventListener("mousedown",h=>{h.preventDefault()}),a.addEventListener("click",h=>{h.preventDefault(),this.f(n,i,s.data),this.e.onSelectItem(s)})}if(this.e.notFoundMessage){let t=document.createElement("li");t.setAttribute("role","presentation"),t.classList.add(p+"not-found"),t.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(t)}}reset(){this.removeAll(),this.d=!1;for(let e=0;e<this.u.length;e++){let t=this.u[e];this.addItem(t.textContent,t.value,t.dataset)}this.a(),this.d=!0}resetSearchInput(e=!1){this.s.value="",this.a(),e||(this.c(),this.s===document.activeElement&&this.s.dispatchEvent(new Event("input"))),this.e.max&&this.getSelectedValues().length>=this.e.max?this.s.style.visibility="hidden":this.s.style.visibility=="hidden"&&(this.s.style.visibility="visible"),this.isSingle()&&!e&&document.activeElement.blur()}getSelectedValues(){let e=this.l.querySelectorAll("option[selected]");return Array.from(e).map(t=>t.value)}N(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}m(){if(!this.N()){this.c();return}this.e.liveServer?this.E():this.b()}b(){if(this.s.style.visibility=="hidden")return;let e=L(this.s.value).toLowerCase(),t=this.getSelectedValues(),s=this.i.querySelectorAll("li"),i=0,l=null,n=!1;for(let r=0;r<s.length;r++){let a=s[r],h=a.querySelector("a");if(!h){a.style.display="none";continue}if(h.classList.remove(...f),!this.e.allowSame&&t.indexOf(h.getAttribute(u))!=-1){a.style.display="none";continue}n=!0;let c=L(a.textContent).toLowerCase(),d=e.length>0?c.indexOf(e)>=0:!0;this.e.showAllSuggestions||d?(i++,a.style.display="list-item",!l&&d&&(l=a),this.e.maximumItems>0&&i>this.e.maximumItems&&(a.style.display="none")):a.style.display="none"}if(l||this.e.showAllSuggestions?(this.n.classList.remove("is-invalid"),l&&this.e.autoselectFirst&&this.p(v)):!this.e.allowNew&&!(e.length===0&&!n)?this.n.classList.add("is-invalid"):this.e.regex&&this.isInvalid()&&this.n.classList.remove("is-invalid"),i===0||this.isInvalid())if(this.e.notFoundMessage){let r=this.i.querySelector("."+p+"not-found");r.style.display="block"}else this.c();else this.i.classList.add("show"),this.s.ariaExpanded="true",this.v()}V(){if(this.e.fixed)return!0;let e=this.n.parentElement;for(;e&&e instanceof HTMLElement;){if(e.style.position==="fixed")return!0;e=e.parentElement}return!1}v(){let e=this.s.getBoundingClientRect(),t=this.V();if(this.e.fullWidth)this.i.style.left=-1+"px",this.i.style.width=this.n.offsetWidth+"px";else{let s=this.e.fixed?e.x:this.s.offsetLeft,l=(t?window.innerWidth:document.body.offsetWidth)-1-(e.x+this.i.offsetWidth);l<0&&(s+=l),this.i.style.left=s+"px"}if(this.e.fixed)this.i.style.transform="translateY(calc(-"+window.pageYOffset+"px))";else{let s=t?window.innerHeight:document.body.offsetHeight,i=e.y+window.pageYOffset+this.i.offsetHeight;s-i<0&&s>e.height?this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))":this.i.style.transform="none"}}c(){this.i.classList.remove("show"),this.n.classList.remove("is-invalid"),this.s.ariaExpanded="false",this.removeSelection()}S(){let e=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(e=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),e}P(e){let t=Array.from(this.l.querySelectorAll("option")).find(s=>s.textContent==e);return!!(t&&t.getAttribute("selected"))}q(){this.e.server&&!this.e.liveServer?this.g():this.resetSuggestions()}M(e){return new RegExp(this.e.regex.trim()).test(e)}getSelection(){return this.i.querySelector("a."+E)}removeSelection(){let e=this.getSelection();e&&e.classList.remove(...f)}getActiveSelection(){return this.getSelection()}removeActiveSelection(){return this.removeSelection()}removeAll(){this.getSelectedValues().forEach(t=>{this.removeItem(t,!0)}),this.a()}removeLastItem(e=!1){let t=this.r.querySelectorAll("span");if(!t.length)return;let s=t[t.length-1];this.removeItem(s.getAttribute(u),e),e||this.e.onClearItem(s.getAttribute(u))}isDisabled(){return this.l.hasAttribute("disabled")||this.l.disabled||this.l.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains("show")}isInvalid(){return this.n.classList.contains("is-invalid")}isSingle(){return!this.l.hasAttribute("multiple")}canAdd(e,t=null){return t||(t=e),!e||this.isDisabled()||!this.isSingle()&&!this.e.allowSame&&this.P(e)||this.e.max&&this.getSelectedValues().length>=this.e.max?!1:this.e.regex&&!this.M(e)?(this.n.classList.add("is-invalid"),!1):!0}addItem(e,t=null,s={}){t||(t=e),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);let i=this.l.querySelectorAll('option[value="'+t+'"]'),l=null;if(this.e.allowSame?i.forEach(n=>{n.textContent===e&&!n.selected&&(l=n)}):l=i[0]??null,!l){l=document.createElement("option"),l.value=t,l.textContent=e;for(let[n,r]of Object.entries(s))l.dataset[n]=r;this.l.appendChild(l)}l&&(s=Object.assign({},s,l.dataset)),l.setAttribute("selected","selected"),l.selected=!0,this.w(e,t,s),this.d&&this.l.dispatchEvent(new Event("change",{bubbles:!0}))}w(e,t=null,s={}){let i=this.S(),l=e,n=document.createElement("span"),r=["badge"],a=this.e.badgeStyle;if(s.badgeStyle&&(a=s.badgeStyle),s.badgeClass&&r.push(...s.badgeClass.split(" ")),this.e.baseClass?(i===5?r.push("me-2"):r.push("mr-2"),r.push(...this.e.baseClass.split(" "))):i===5?r=[...r,"me-2","my-1","bg-"+a,"mw-100","overflow-x-hidden"]:r=[...r,"mr-2","my-1","badge-"+a],n.classList.add(...r),n.setAttribute(u,t),this.e.allowClear){let h=r.includes("text-dark")?"btn-close":"btn-close-white",c,d;this.e.clearEnd?(c=i===5?"ms-2":"ml-2",d=i===5?"float-end":"float:right;"):(c=i===5?"me-2":"mr-2",d=i===5?"float-start":"float:left;"),l=(i===5?'<button type="button" style="font-size:0.65em" class="'+c+" "+d+" btn-close "+h+'" aria-label="'+this.e.clearLabel+'"></button>':'<button type="button" style="font-size:1em;'+d+'text-shadow:none;color:currentColor;transform:scale(1.2)" class="'+c+' close" aria-label="'+this.e.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+l}n.innerHTML=l,this.r.insertBefore(n,this.s),this.e.allowClear&&n.querySelector("button").addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.isDisabled()||(this.removeItem(t),this.e.onClearItem(t),document.activeElement.blur(),this.a())})}removeItem(e,t=!1){let s=this.r.querySelector("span["+u+'="'+e+'"]');if(!s)return;s.remove();let i=this.l.querySelector('option[value="'+e+'"][selected]');i&&(i.removeAttribute("selected"),i.selected=!1,this.d&&!t&&this.l.dispatchEvent(new Event("change",{bubbles:!0}))),this.s.style.visibility=="hidden"&&this.e.max&&this.getSelectedValues().length<this.e.max&&(this.s.style.visibility="visible")}},F=m;export{F as default};
//# sourceMappingURL=tags.min.js.map
